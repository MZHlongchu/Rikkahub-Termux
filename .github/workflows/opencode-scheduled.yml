name: opencode-scheduled

on:
  schedule:
    - cron: "0 1 * * 1" # Every Monday at 09:00 Asia/Shanghai (01:00 UTC)
  workflow_dispatch:

jobs:
  opencode:
    runs-on: ubuntu-latest
    permissions:
      id-token: write
      contents: write
      pull-requests: write
      issues: write
    steps:
      - name: Checkout repository
        uses: actions/checkout@v6
        with:
          persist-credentials: false

      - name: Run opencode
        uses: anomalyco/opencode/github@latest
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          GITHUB_TOKEN: ${{ secrets.WORKFLOW_PAT }}
        with:
          model: openai/gpt-5.2-codex
          use_github_token: true
          prompt: |
            Review the codebase broadly with three goals: (1) find potential bugs or fragile logic, (2) propose practical
            new feature ideas that fit the existing product scope, and (3) suggest concrete UX improvements in flows,
            copy, or interaction patterns. Prefer high-signal findings over exhaustive lists.
            For each finding, include a concise title, a short explanation of impact/risk/value, and the file or area
            it relates to. If issues are warranted, open them directly without asking for confirmation.
            Provide a brief summary of what you did at the end; do not ask questions.
